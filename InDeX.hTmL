<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ماشین حساب مدیریت ریسک حرفه‌ای</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <div id="root" class="min-h-screen flex items-center justify-center p-4"></div>
  <script type="text/babel">
    const { useState } = React;

    const symbols = {
      "EURUSD": 10,
      "GBPUSD": 10,
      "USDJPY": 9.1,
      "XAUUSD": 1,
      "XAGUSD": 0.5,
      "BTCUSD": 1,
    };

    function TradeCalculator() {
      const [trades, setTrades] = useState([]);
      const [form, setForm] = useState({symbol: "EURUSD", balance: "", risk: "", entry: "", stop: "", target: ""});

      const calculate = () => {
        const balance = parseFloat(form.balance) || 0;
        const risk = parseFloat(form.risk) || 0;
        const entry = parseFloat(form.entry) || 0;
        const stop = parseFloat(form.stop) || 0;
        const target = parseFloat(form.target) || 0;
        const pipValue = symbols[form.symbol] || 10;

        if (!entry || !stop || !balance || !risk) return;

        const riskAmount = (balance * risk) / 100;
        const pipDiff = Math.abs(entry - stop);
        const lot = pipDiff ? (riskAmount / (pipDiff * pipValue)).toFixed(2) : 0;
        const reward = Math.abs(entry - target) * parseFloat(lot) * pipValue;
        const rr = riskAmount ? (reward / riskAmount).toFixed(2) : 0;

        setTrades([...trades, { ...form, lot, riskAmount: riskAmount.toFixed(2), rr }]);
      };

      const clearAll = () => setTrades([]);
      const deleteTrade = (index) => setTrades(trades.filter((_, i) => i !== index));

      return (
        <div className="w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 space-y-4">
          <h1 className="text-2xl font-bold text-center">ماشین حساب مدیریت ریسک و حجم معامله</h1>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-semibold mb-1">نماد</label>
              <select
                className="w-full p-2 border rounded-xl dark:bg-gray-700"
                value={form.symbol}
                onChange={(e) => setForm({ ...form, symbol: e.target.value })}
              >
                {Object.keys(symbols).map((sym) => (
                  <option key={sym} value={sym}>{sym}</option>
                ))}
              </select>
            </div>
            {["balance","risk","entry","stop","target"].map((key) => (
              <div key={key}>
                <label className="block text-sm font-semibold mb-1">
                  {key==="balance"?"موجودی":key==="risk"?"درصد ریسک":key==="entry"?"ورودی":key==="stop"?"استاپ لاس":"تارگت"}
                </label>
                <input
                  className="w-full p-2 border rounded-xl dark:bg-gray-700"
                  value={form[key]}
                  onChange={(e)=>setForm({ ...form, [key]: e.target.value })}
                  type="number"
                />
              </div>
            ))}
          </div>
          <div className="flex gap-2">
            <button onClick={calculate} className="flex-1 bg-blue-500 text-white py-2 rounded-xl hover:bg-blue-600">محاسبه</button>
            <button onClick={clearAll} className="flex-1 bg-red-500 text-white py-2 rounded-xl hover:bg-red-600">پاک کردن همه</button>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full text-sm text-left mt-4 border">
              <thead>
                <tr className="bg-blue-500 text-white">
                  <th className="p-2">نماد</th>
                  <th className="p-2">ورودی</th>
                  <th className="p-2">استاپ</th>
                  <th className="p-2">لات</th>
                  <th className="p-2">ریسک ($)</th>
                  <th className="p-2">R:R</th>
                  <th className="p-2 text-center">حذف</th>
                </tr>
              </thead>
              <tbody>
                {trades.map((t,i)=>(
                  <tr key={i} className="odd:bg-white even:bg-gray-50 dark:odd:bg-gray-700 dark:even:bg-gray-600">
                    <td className="p-2">{t.symbol}</td>
                    <td className="p-2">{t.entry}</td>
                    <td className="p-2">{t.stop}</td>
                    <td className="p-2">{t.lot}</td>
                    <td className="p-2">{t.riskAmount}</td>
                    <td className={`p-2 ${parseFloat(t.rr)>=2?"text-green-600 font-bold":parseFloat(t.rr)<1?"text-red-600 font-bold":""}`}>{t.rr}</td>
                    <td className="p-2 text-center">
                      <button onClick={()=>deleteTrade(i)} className="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">X</button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    ReactDOM.render(<TradeCalculator />, document.getElementById("root"));
  </script>
</body>
</html>
